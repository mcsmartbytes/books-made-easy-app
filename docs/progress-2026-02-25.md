# Progress Report — February 25, 2026

## Vercel Deployment Fixes

### Completed

- **Fixed Vercel build failure — remaining `@neondatabase/serverless` imports**
  - `src/app/api/auth/signup/route.ts` and `src/lib/auth.ts` still had Neon imports in committed code
  - Updated both to use `@/lib/db` (Turso)
  - Commit: `feb60a2`

- **Fixed manifest icon 404 errors**
  - `public/manifest.json` referenced `.webp` files outside `public/` directory
  - Updated to use existing `.png` files in `public/icons/`
  - Commit: `5cbadfd`

- **Added `force-dynamic` to all 28 API routes**
  - Next.js was statically rendering routes that use `request.url`/`request.nextUrl`
  - Caused 500 errors on Vercel for all GET API endpoints
  - Commit: `5cf9095`

- **Applied schema to Vercel's Turso database**
  - Turso-Vercel integration created a separate database: `database-books-made-easy-vercel-*` (us-east-1)
  - Our manually created `books-made-easy` (us-west-2) had the schema but Vercel wasn't using it
  - Applied all 29 tables via Turso HTTP API to the Vercel-managed database
  - Triggers not applied (semicolons in BEGIN/END blocks broke HTTP batch) — timestamps handled in app code

- **Created missing `/api/categories` route**
  - Onboarding was failing with 405 because this route didn't exist
  - Added full CRUD (GET, POST, PUT, DELETE) with batch insert support
  - Commit: `b411316`

- **Bumped service worker cache version (v1 → v2)**
  - Old SW was caching stale manifest with `.webp` icon references
  - Commit: `b411316`

- **Added Vercel environment variables**
  - `NEXTAUTH_SECRET` — required for NextAuth JWT signing
  - `NEXTAUTH_URL` — set to `https://books-made-easy-app.vercel.app`
  - `TURSO_DATABASE_URL` and `TURSO_AUTH_TOKEN` — managed by Turso-Vercel integration

### Verified Working on Vercel
- Signup flow → creates user in Turso
- Login via NextAuth credentials
- Onboarding (company name, industry selection, category + account seeding)
- Dashboard loads after onboarding

### Key Discovery: Two Turso Databases
- **Manual database**: `libsql://books-made-easy-mcsmartbytes.aws-us-west-2.turso.io`
- **Vercel integration database**: `libsql://database-books-made-easy-vercel-icfg-4bpyl4fl8yak9tuwfgurjuas.aws-us-east-1.turso.io`
- Vercel uses the integration database — all schema changes must go there

### Commits Today
- `feb60a2` — Fix Vercel build: remove remaining @neondatabase/serverless imports
- `5cbadfd` — Fix manifest icons to use existing PNG files in public/icons
- `5cf9095` — Add force-dynamic to all API routes using request.url
- `b411316` — Add missing /api/categories route and bust SW cache

---

## Status: Testing Phase
User is testing all features on the live Vercel deployment. Next session will address any bugs found during testing, then move on to new features.

### Planned Next Steps (After Testing)
- PDF generation for invoices/reports
- Multi-client support for bookkeeping company pitch
- Tax preparation module (1040, Schedule C, quarterly estimates)
- Bank feeds integration (Plaid)
- User roles and permissions
